<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026ä¸–ç•Œæ¯èªæ—¥ - makila kuman</title>
    
    <!-- è¼‰å…¥ Tailwind CSS (æ¨£å¼åº«) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è¼‰å…¥ Babel (è®“ç€è¦½å™¨å¯ä»¥çœ‹æ‡‚ React JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- è£œå¼· 3D ç¿»è½‰æ•ˆæœçš„ CSS -->
    <style>
        .perspective-1000 {
            perspective: 1000px;
        }
        .transform-style-3d {
            transform-style: preserve-3d;
        }
        .backface-hidden {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
        
        /* éŒ¯èª¤æ™‚çš„éœ‡å‹•å‹•ç•« */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.3s ease-in-out;
        }

        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-stone-900 m-0 p-0 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // é€é ESM CDN è¼‰å…¥ React èˆ‡ç›¸é—œå¥—ä»¶
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
          BookOpen, Edit3, Eye, Search, Gift, 
          Zap, RefreshCw, Check, ArrowRight, ArrowLeft,
          HelpCircle, Image as ImageIcon, LayoutGrid,
          Map, Hammer, UserCheck, MessageCircle, Info, ChevronLeft, ChevronRight, ThumbsUp, MapPin, Lock, Delete, LogIn, CreditCard, CheckCircle2
        } from 'https://esm.sh/lucide-react@0.263.1';

        // ==========================================
        // CONFIGURATION (è¨­å®šå€)
        // ==========================================
        // æ‚¨çš„ Google Apps Script ç¶²å€
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbzCJVchaq7JMq1SJvNNNHzj1ojJDgmcffgoscCnrN5lx32_RvAzy1NSQT-VJWLush4/exec";

        // ==========================================
        // ZONE COMPONENTS
        // ==========================================

        // --- Zone A: åŸä½æ°‘æ–‡åŒ–çŸ¥è­˜é€š (å„ªåŒ–å°è¦½ç‰ˆ) ---
        const TribeIntroZone = () => {
          // å®Œæ•´ 16 æ—è³‡æ–™åº« (æ–°å¢ region åˆ†é¡)
          const allTribes = [
            { title: "é˜¿ç¾æ— (Amis)", region: "æ±éƒ¨/èŠ±è“®å°æ±", subtitle: "è±å¹´ç¥­ (Ilisin)", content: "äººå£æœ€å¤šã€‚è±å¹´ç¥­åŒ…å«è»äº‹èˆ‡æ•™è‚²åŠŸèƒ½ï¼Œæ˜¯æ—äººå‘½è„ˆæ ¹æºã€‚", icon: "ğŸŒ¾", color: "bg-red-500" },
            { title: "æ’ç£æ— (Paiwan)", region: "å—éƒ¨/å±æ±å°æ±", subtitle: "æ”¶ç©«ç¥­ (Masalut)", content: "æœ‰åš´è¬¹éšç´šåˆ¶åº¦ã€‚å°ç±³æ”¶ç©«ç¥­ Masalut ä»£è¡¨ã€Œè·¨è¶Šã€æ–°å¹´ã€‚", icon: "ğŸ", color: "bg-slate-700" },
            { title: "æ³°é›…æ— (Atayal)", region: "åŒ—éƒ¨/ä¸­éƒ¨å±±å€", subtitle: "ç¥–éˆç¥­ (Maho)", content: "é‡è¦–ç¹”å¸ƒèˆ‡æ–‡é¢ã€‚ç¥–éˆç¥­é€éå‘¼å–šç¥–éˆç¥ˆæ±‚å¹³å®‰ã€‚", icon: "ğŸŒˆ", color: "bg-red-700" },
            { title: "å¸ƒè¾²æ— (Bunun)", region: "ä¸­å¤®å±±è„ˆ/å—æŠ•", subtitle: "å°„è€³ç¥­ (Malahodaigian)", content: "ç›¸ä¿¡ç²¾éˆ(Hanitu)ã€‚å°„è€³ç¥­è¨“ç·´å°å­©ç‹©çµï¼Œç²å¾—ç¤¾æœƒèªåŒã€‚", icon: "ğŸ¹", color: "bg-amber-600" },
            { title: "å‘å—æ— (Puyuma)", region: "æ±éƒ¨/å°æ±å¹³åŸ", subtitle: "å¹´ç¥­ (çŒ´ç¥­/å¤§çµç¥­)", content: "æœ‰åš´è¬¹çš„å¹´é½¡éšç´šèˆ‡æœƒæ‰€åˆ¶åº¦ã€‚å¹´ç¥­åŒ…å«çŒ´ç¥­èˆ‡å¤§çµç¥­ã€‚", icon: "ğŸ’", color: "bg-yellow-600" },
            { title: "é­¯å‡±æ— (Rukai)", region: "å—éƒ¨/å±æ±é«˜é›„", subtitle: "ç™¾åˆèŠ±èˆ‡ç›ªé¦éŸ†", content: "ä»¥ç™¾åˆèŠ±ç‚ºæ—èŠ±ã€‚å©šç¦®æ™‚æœƒèˆ‰è¡Œç›ªé¦éŸ†æ´»å‹•ï¼Œåˆ†äº«å–œæ‚…ã€‚", icon: "ğŸŒº", color: "bg-emerald-600" },
            { title: "é„’æ— (Tsou)", region: "ä¸­éƒ¨/å˜‰ç¾©é˜¿é‡Œå±±", subtitle: "æˆ°ç¥­ (Mayasvi)", content: "ç¥­æ‹œå¤©ç¥èˆ‡æˆ°ç¥ã€‚åœ¨åº«å·´(Kuba)ç”·å­æœƒæ‰€èˆ‰è¡Œï¼Œç¥ˆç¦±å‹åˆ©ã€‚", icon: "ğŸ”¥", color: "bg-red-600" },
            { title: "è³½å¤æ— (Saisiyat)", region: "åŒ—éƒ¨/æ–°ç«¹è‹—æ —", subtitle: "çŸ®éˆç¥­ (Pasta'ay)", content: "æ¯å…©å¹´èˆ‰è¾¦ä¸€æ¬¡ï¼Œç‚ºäº†ç´€å¿µä¸¦å®‰æ’«æ•™æœƒä»–å€‘è¾²è€•çš„çŸ®äººéˆé­‚ã€‚", icon: "ğŸŒ‘", color: "bg-indigo-700" },
            { title: "é”æ‚Ÿæ— (Tao)", region: "é›¢å³¶/è˜­å¶¼", subtitle: "é£›é­šç¥­", content: "å”¯ä¸€çš„æµ·æ´‹æ°‘æ—ã€‚éš¨é»‘æ½®èˆ‰è¡Œæ‹›é­šç¥­ï¼Œæœ‰åš´æ ¼çš„ç”Ÿæ…‹è¦ç¯„ã€‚", icon: "ğŸŸ", color: "bg-blue-500" },
            { title: "é‚µæ— (Thao)", region: "ä¸­éƒ¨/å—æŠ•æ—¥æœˆæ½­", subtitle: "ç¥–éˆç±ƒèˆ‡æµéŸ³", content: "ä¾›å¥‰ç¥–éˆç±ƒ(Ulalaluan)ã€‚æµéŸ³éŸ³æ¨‚èåï¼Œè¾²æ›†å…«æœˆéå¹´ã€‚", icon: "ğŸŒŠ", color: "bg-amber-700" },
            { title: "å™¶ç‘ªè˜­æ— (Kavalan)", region: "æ±éƒ¨/èŠ±è“®", subtitle: "æµ·ç¥­èˆ‡é¦™è•‰çµ²", content: "ä¿æœ‰ç¨ç‰¹é¦™è•‰çµ²ç·¨ç¹”ã€‚æ˜¥å¤é–“èˆ‰è¡Œæµ·ç¥­ï¼Œæ„Ÿè¬æµ·æ´‹è³œé£Ÿã€‚", icon: "ğŸŒ", color: "bg-yellow-700" },
            { title: "å¤ªé­¯é–£æ— (Truku)", region: "æ±éƒ¨/èŠ±è“®å±±å€", subtitle: "å½©è™¹æ©‹å‚³èªª", content: "é‡è¦–ç¹”å¸ƒèˆ‡æ–‡é¢ã€‚æ­»å¾Œè¦é€šéå½©è™¹æ©‹(Hakaw Utux)è¦‹ç¥–éˆã€‚", icon: "ğŸŒ‰", color: "bg-teal-600" },
            { title: "æ’’å¥‡èŠé›…æ— (Sakizaya)", region: "æ±éƒ¨/èŠ±è“®", subtitle: "ç«ç¥ç¥­ (Palamal)", content: "æ›¾éš±èº«é˜¿ç¾æ—ç™¾å¹´ã€‚ç«ç¥ç¥­ç´€å¿µç¥–å…ˆï¼ŒåŒ…å«ç¹å¢ƒå„€å¼ã€‚", icon: "ğŸ”¥", color: "bg-orange-700" },
            { title: "è³½å¾·å…‹æ— (Seediq)", region: "ä¸­éƒ¨/å—æŠ•èŠ±è“®", subtitle: "å´‡ä¿¡ Utux", content: "å¹³æ¬Šç¤¾æœƒã€‚ç¥­å„€é‡é»åœ¨ç¥ˆæ±‚æ—é‹èˆ‡ Utux (ç¥/ç¥–éˆ) çš„åº‡ä½‘ã€‚", icon: "âš”ï¸", color: "bg-red-800" },
            { title: "æ‹‰é˜¿é­¯å“‡æ— (Hla'alua)", region: "å—éƒ¨/é«˜é›„æ¡ƒæº", subtitle: "è–è²ç¥­ (Miatungusu)", content: "æ³¨é‡è¾²è€•ç¥­å„€ã€‚ç¥­ç¥€ 12 ä½è²ç¥ï¼Œæ˜¯ä¸»è¦çš„åœ–é¨°è±¡å¾µã€‚", icon: "ğŸš", color: "bg-cyan-600" },
            { title: "å¡é‚£å¡é‚£å¯Œæ— (Kanakanavu)", region: "å—éƒ¨/é«˜é›„é‚£ç‘ªå¤", subtitle: "ç±³è²¢ç¥­ (Mikong)", content: "é‡è¦ç¥­å„€æœ‰ç±³è²¢ç¥­èˆ‡æ²³ç¥­ã€‚å‚³çµ±ç‹©çµæ–¹å¼åŒ…å«å¸¶ç‹—èˆ‡é™·é˜±ã€‚", icon: "ğŸ•", color: "bg-lime-600" },
          ];

          const [cards, setCards] = useState([]);
          const [idx, setIdx] = useState(0);
          const [flipped, setFlipped] = useState(false);
          const [isFinished, setIsFinished] = useState(false);

          // åˆå§‹åŒ–ï¼šéš¨æ©Ÿé¸ 10 å¼µ
          useEffect(() => {
            restart();
          }, []);

          const restart = () => {
            const shuffled = [...allTribes].sort(() => 0.5 - Math.random());
            setCards(shuffled.slice(0, 10));
            setIdx(0);
            setFlipped(false);
            setIsFinished(false);
          };

          const handleNext = () => {
            if (idx < cards.length - 1) {
              setFlipped(false);
              setTimeout(() => setIdx(prev => prev + 1), 200);
            } else {
              setIsFinished(true);
            }
          };

          const handlePrev = () => {
            if (idx > 0) {
              setFlipped(false);
              setTimeout(() => setIdx(prev => prev - 1), 200);
            }
          };

          if (cards.length === 0) return null;

          return (
            <div className="flex flex-col items-center justify-center h-full bg-stone-100 p-4">
              <div className="absolute top-4 left-4 bg-stone-800 text-white px-4 py-2 rounded-full font-bold flex items-center gap-2 z-10">
                <BookOpen size={20} /> Zone Aï¼šåŸä½æ°‘æ–‡åŒ–çŸ¥è­˜é€š
              </div>

              {!isFinished ? (
                <div className="flex flex-col md:flex-row items-center justify-center gap-8 w-full max-w-5xl">
                  
                  {/* å·¦å´ï¼šåˆ†é¡å°å¡ (Category Card) */}
                  <div className="w-full md:w-64 bg-white rounded-2xl shadow-lg border-l-8 border-amber-500 p-6 flex flex-col justify-between h-48 md:h-80 animate-in slide-in-from-left">
                    <div>
                      <div className="text-stone-400 font-bold text-xs uppercase tracking-widest mb-2">Current Tribe</div>
                      <h2 className="text-3xl font-black text-stone-800 leading-tight mb-2">
                        {cards[idx].title.split(' ')[0]}
                      </h2>
                      <div className="flex items-center gap-2 text-stone-500 font-bold text-sm">
                        <MapPin size={16} /> {cards[idx].region}
                      </div>
                    </div>
                    
                    <div>
                      <div className="w-full bg-stone-100 rounded-full h-2 mb-2">
                        <div 
                          className="bg-amber-500 h-2 rounded-full transition-all duration-500" 
                          style={{ width: `${((idx + 1) / cards.length) * 100}%` }}
                        ></div>
                      </div>
                      <div className="text-right text-stone-400 font-bold text-lg">
                        {idx + 1} / {cards.length}
                      </div>
                    </div>
                  </div>

                  {/* ä¸­é–“ï¼šç¿»è½‰å­¸ç¿’å¡ */}
                  <div className="flex flex-col items-center gap-6">
                    <div className="w-80 h-[420px] perspective-1000 cursor-pointer" onClick={() => setFlipped(!flipped)}>
                      <div className={`relative w-full h-full duration-500 transform-style-3d transition-all ${flipped ? 'rotate-y-180' : ''}`}>
                        
                        {/* æ­£é¢ */}
                        <div className={`absolute w-full h-full ${cards[idx].color} rounded-3xl shadow-xl border-4 border-white p-8 flex flex-col items-center justify-center backface-hidden text-white`}>
                          <div className="text-9xl mb-8 drop-shadow-md">{cards[idx].icon}</div>
                          <h2 className="text-4xl font-black mb-4 text-center">{cards[idx].title}</h2>
                          <div className="bg-white/20 px-4 py-2 rounded-full text-lg font-bold text-center">
                            {cards[idx].subtitle}
                          </div>
                          <p className="absolute bottom-8 text-white/60 font-bold animate-pulse flex items-center gap-2">
                            <RefreshCw size={16}/> é»æ“Šç¿»é¢çœ‹ä»‹ç´¹
                          </p>
                        </div>

                        {/* èƒŒé¢ */}
                        <div className="absolute w-full h-full bg-white rounded-3xl shadow-xl border-8 border-stone-300 p-8 flex flex-col items-center justify-center backface-hidden rotate-y-180 text-center">
                          <h3 className="text-2xl font-black text-stone-800 mb-6 border-b-2 border-stone-100 pb-2 w-full">
                            æ–‡åŒ–å°çŸ¥è­˜
                          </h3>
                          <div className="text-xl text-stone-600 font-bold leading-loose">
                            {cards[idx].content}
                          </div>
                          <div className="mt-auto text-stone-400 text-sm font-bold bg-stone-100 px-4 py-2 rounded-lg w-full">
                            *è¶•å¿«è¨˜ä¸‹ä¾†ï¼Œç­‰ä¸€ä¸‹æœƒè€ƒå–”ï¼
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* å°è¦½æŒ‰éˆ•å€ */}
                    <div className="flex gap-4 w-full">
                      <button 
                        onClick={handlePrev}
                        disabled={idx === 0}
                        className={`flex-1 py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ${
                          idx === 0 
                            ? 'bg-stone-200 text-stone-400 cursor-not-allowed' 
                            : 'bg-white text-stone-600 shadow-md hover:bg-stone-50'
                        }`}
                      >
                        <ArrowLeft size={20}/> ä¸Šä¸€å€‹
                      </button>
                      
                      <button 
                        onClick={handleNext}
                        className="flex-[2] py-3 bg-stone-800 text-white rounded-xl font-bold shadow-lg hover:bg-stone-700 hover:scale-105 transition-transform active:scale-95 flex items-center justify-center gap-2"
                      >
                        {idx === cards.length - 1 ? "å®Œæˆå­¸ç¿’" : "æˆ‘è¨˜èµ·ä¾†å›‰ï¼"} <ThumbsUp size={20}/>
                      </button>
                    </div>
                  </div>

                </div>
              ) : (
                <div className="w-full max-w-lg text-center animate-in zoom-in">
                  <div className="text-8xl mb-6">ğŸ“</div>
                  <h2 className="text-4xl font-black text-stone-800 mb-4">å­¸ç¿’å®Œæˆï¼</h2>
                  <p className="text-xl text-stone-600 mb-8 font-bold">ä½ å·²ç¶“çœ‹å®Œäº† 10 å€‹æ—ç¾¤çš„çŸ¥è­˜ã€‚<br/>æº–å‚™å¥½æ¥å—éš¨å ‚è€ƒäº†å—ï¼Ÿ</p>
                  <div className="flex gap-4 justify-center">
                    <button onClick={restart} className="px-6 py-3 bg-white text-stone-500 rounded-xl font-bold shadow-md hover:bg-stone-50">
                      å†è¤‡ç¿’ä¸€æ¬¡
                    </button>
                    <div className="px-6 py-3 bg-amber-500 text-white rounded-xl font-bold shadow-md animate-bounce">
                      è«‹å‰å¾€ Zone B è€ƒè©¦ï¼ğŸ‘‡
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // --- Zone B: å¡ç‰‡è§£å¯†æ¸¬é©— (Multi-Select Version) ---
        const TribeQuizZone = () => {
          const [phase, setPhase] = useState('select'); // 'select', 'quiz', 'summary'
          const [selectedCards, setSelectedCards] = useState([]); // Array of card objects
          const [currentCardIdx, setCurrentCardIdx] = useState(0); // Index in selectedCards (0, 1, 2)
          const [isAnswered, setIsAnswered] = useState(false);
          const [isCorrect, setIsCorrect] = useState(false);
          const [score, setScore] = useState(0);

          // å¡ç‰‡é¡Œåº«è³‡æ–™ (å°æ‡‰å¯¦é«”å¡ç‰‡ 01-20)
          const cardData = [
            { id: 1, title: "åŸä½æ°‘æ—", q: "å°ç£åŸä½æ°‘æ—ç›®å‰å®˜æ–¹èªå®šå…±æœ‰å¹¾æ—ï¼Ÿ", options: ["9æ—", "14æ—", "16æ—"], ans: 2 },
            { id: 2, title: "ç¥­å…¸çš„æ„ç¾©", q: "åŸä½æ°‘èˆ‰è¾¦ç¥­å…¸çš„ä¸»è¦æ„ç¾©æ˜¯ä»€éº¼ï¼Ÿ", options: ["å–®ç´”èšé¤", "è¡¨é”å°å¤©åœ°é¬¼ç¥çš„å´‡æ•¬", "é‹å‹•ç«¶æŠ€æ¯”è³½"], ans: 1 },
            { id: 3, title: "é˜¿ç¾æ—", q: "é˜¿ç¾æ—æœ€ç››å¤§çš„ç¥­å…¸ã€Œè±å¹´ç¥­ã€é€šå¸¸åœ¨ä»€éº¼æ™‚å€™èˆ‰è¾¦ï¼Ÿ", options: ["æ˜¥ç¯€æœŸé–“", "7æœˆä¸­æ—¬è‡³9æœˆåˆ", "12æœˆå¯’å†¬"], ans: 1 },
            { id: 4, title: "æ’ç£æ—", q: "æ’ç£æ—çš„ã€ŒMasalutã€ç¥­å…¸ä¸­ï¼Œã€ŒSalutã€é€™å€‹å­—ä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿ", options: ["è·¨è¶Š/é‚å‘æ–°å¹´", "è±æ”¶", "æ‰“çµ"], ans: 0 },
            { id: 5, title: "æ³°é›…æ—", q: "æ³°é›…æ—æœ€é‡è¦çš„ä¿¡ä»°ä¸­å¿ƒæ˜¯ä»€éº¼ï¼Ÿ", options: ["å¤ªé™½ç¥", "ç¥–éˆ (Utux)", "ç™¾æ­¥è›‡"], ans: 1 },
            { id: 6, title: "å¸ƒè¾²æ—", q: "å¸ƒè¾²æ—çš„ã€Œå°„è€³ç¥­ã€é™¤äº†ç¥­ç¥€ï¼Œé‚„æœ‰ä»€éº¼é‡è¦åŠŸèƒ½ï¼Ÿ", options: ["è¨“ç·´å°å­©ç‹©çµèˆ‡æˆé•·", "å°‹æ‰¾çµå©šå°è±¡", "ç¥ˆæ±‚ä¸‹é›¨"], ans: 0 },
            { id: 7, title: "å¤ªé­¯é–£æ—", q: "å¤ªé­¯é–£æ—æ“…é•·çš„å·¥è—é™¤äº†è—¤ç·¨ï¼Œé‚„æœ‰ä»€éº¼ï¼Ÿ", options: ["é™¶å£ºè£½ä½œ", "å½©è™¹èˆ¬çš„ç¹”å¸ƒ", "é€ èˆ¹"], ans: 1 },
            { id: 8, title: "å‘å—æ—", q: "å‘å—æ—ç››å¤§çš„ã€Œå¹´ç¥­ã€ä¸­ï¼ŒåŒ…å«äº†å“ªå…©å€‹é‡è¦æ´»å‹•ï¼Ÿ", options: ["çŒ´ç¥­èˆ‡å¤§çµç¥­", "é£›é­šç¥­èˆ‡æµ·ç¥­", "æˆ°ç¥­èˆ‡å°ç±³ç¥­"], ans: 0 },
            { id: 9, title: "é­¯å‡±æ—", q: "é­¯å‡±æ—åœ¨å©šç¦®æˆ–ç¥­å…¸ä¸­ï¼Œå¸¸æœƒèˆ‰è¾¦ä»€éº¼æµªæ¼«çš„æ´»å‹•ï¼Ÿ", options: ["ç›ªé¦éŸ†", "è³½è·‘", "å°„ç®­"], ans: 0 },
            { id: 10, title: "è³½å¾·å…‹æ—", q: "è³½å¾·å…‹æ—é™¤äº†å¥³å­ç¹”å¸ƒå¤–ï¼Œç”·å­æ“…é•·ä»€éº¼å·¥è—ï¼Ÿ", options: ["ç·¨ç±ƒåŠç±å¸½", "è£½ä½œç‰ç’ƒç ", "é›•åˆ»çŸ³æ¿"], ans: 0 },
            { id: 11, title: "é„’æ—", q: "é„’æ—çš„ã€Œå‡±æ—‹ç¥­ (Mayasvi)ã€ä¸»è¦æ˜¯ç¥­æ‹œå“ªä½ç¥ç¥‡ï¼Ÿ", options: ["æµ·ç¥", "å¤©ç¥èˆ‡æˆ°ç¥", "è¾²ç¥"], ans: 1 },
            { id: 12, title: "è³½å¤æ—", q: "è³½å¤æ—çš„ã€ŒçŸ®éˆç¥­ (Pasta'ay)ã€æ˜¯ç‚ºäº†ç´€å¿µèª°ï¼Ÿ", options: ["é”éš˜ (çŸ®äºº)", "ç¥–å…ˆ", "å·¨äºº"], ans: 0 },
            { id: 13, title: "é›…ç¾æ—(é”æ‚Ÿæ—)", q: "é›…ç¾æ—(é”æ‚Ÿæ—)æœ€é‡è¦çš„ç”Ÿæ…‹æ–‡åŒ–èˆ‡ä»€éº¼æœ‰é—œï¼Ÿ", options: ["å±±è±¬", "é£›é­š", "ç™¾åˆèŠ±"], ans: 1 },
            { id: 14, title: "å™¶ç‘ªè˜­æ—", q: "å™¶ç‘ªè˜­æ—ä¿æœ‰å“ªé …éå¸¸æœ‰ç‰¹è‰²çš„å·¥è—æŠ€è¡“ï¼Ÿ", options: ["ç·¨ç¹”é¦™è•‰çµ²", "è£½ä½œé™¶å£º", "çš®é›•"], ans: 0 },
            { id: 15, title: "æ’’å¥‡èŠé›…æ—", q: "æ’’å¥‡èŠé›…æ—çš„ã€Œç«ç¥ç¥­ (Palamal)ã€æ˜¯ç‚ºäº†ç´€å¿µä»€éº¼ï¼Ÿ", options: ["æ—ç¾¤é‡ç”Ÿèˆ‡ç¥–å…ˆ", "è±æ”¶", "æˆå¹´ç¦®"], ans: 0 },
            { id: 16, title: "é‚µæ—", q: "é‚µæ—å®¶å®¶æˆ¶æˆ¶ä¾›å¥‰ä»€éº¼ä¾†è±¡å¾µç¥–éˆï¼Ÿ", options: ["ç¥–éˆç±ƒ (Ulalaluan)", "é™¶å£º", "ç™¾æ­¥è›‡ç´‹"], ans: 0 },
            { id: 17, title: "æ‹‰é˜¿é­¯å“‡æ—", q: "æ‹‰é˜¿é­¯å“‡æ—çš„ã€Œè–è²ç¥­ã€ç¥­ç¥€çš„å°è±¡æ˜¯ï¼Ÿ", options: ["å¤ªé™½ç¥", "12ä½è²ç¥", "å±±ç¥"], ans: 1 },
            { id: 18, title: "å¡é‚£å¡é‚£å¯Œæ—", q: "å¡é‚£å¡é‚£å¯Œæ—çš„é‡è¦ç¥­å„€ã€Œç±³è²¢ç¥­ã€ä¸»è¦æ„Ÿè¬ä»€éº¼ï¼Ÿ", options: ["å°ç±³è±æ”¶", "çµç‰©è±æ”¶", "æˆ°é¬¥å‹åˆ©"], ans: 0 },
            { id: 19, title: "æ­£åä¹‹è·¯", q: "å“ªå…©å€‹æ—ç¾¤åœ¨ 2014 å¹´çµ‚æ–¼æ­£åæˆåŠŸï¼Ÿ", options: ["é‚µæ—èˆ‡å™¶ç‘ªè˜­æ—", "æ‹‰é˜¿é­¯å“‡æ—èˆ‡å¡é‚£å¡é‚£å¯Œæ—", "è³½å¾·å…‹æ—èˆ‡å¤ªé­¯é–£æ—"], ans: 1 },
            { id: 20, title: "æ¢ç´¢å°ç£ä¹‹ç¾", q: "å¡ç‰‡ä¸­æåˆ°æ¢ç´¢å°ç£åŸæ°‘æ–‡åŒ–æœ€å¥½çš„æ–¹å¼æ˜¯ï¼Ÿ", options: ["åœ¨å®¶çœ‹é›»è¦–", "èµ°é€²éƒ¨è½é«”é©—ç¾æ™¯èˆ‡ç¾é£Ÿ", "åªçœ‹æ›¸æœ¬"], ans: 1 },
          ];

          const handleToggleCard = (card) => {
            if (selectedCards.find(c => c.id === card.id)) {
              // å¦‚æœå·²ç¶“é¸äº†ï¼Œé»æ“Šå‰‡å–æ¶ˆ
              setSelectedCards(prev => prev.filter(c => c.id !== card.id));
            } else {
              // å¦‚æœé‚„æ²’é¸ï¼Œä¸”æœªæ»¿3å€‹ï¼Œå‰‡åŠ å…¥
              if (selectedCards.length < 3) {
                setSelectedCards(prev => [...prev, card].sort((a, b) => a.id - b.id));
              }
            }
          };

          const handleStartQuiz = () => {
            if (selectedCards.length === 3) {
              setPhase('quiz');
              setCurrentCardIdx(0);
              setScore(0);
              setIsAnswered(false);
              setIsCorrect(false);
            }
          };

          const handleAnswer = (idx) => {
            if (isAnswered) return;
            const currentCard = selectedCards[currentCardIdx];
            const correct = idx === currentCard.ans;
            setIsAnswered(true);
            setIsCorrect(correct);
            if(correct) setScore(s => s + 1);
          };

          const handleNextQuestion = () => {
            if (currentCardIdx < 2) {
              setCurrentCardIdx(prev => prev + 1);
              setIsAnswered(false);
              setIsCorrect(false);
            } else {
              setPhase('summary');
            }
          };

          const resetAll = () => {
            setSelectedCards([]);
            setPhase('select');
          };

          return (
            <div className="flex flex-col items-center justify-center h-full bg-amber-50 p-4">
              <div className="absolute top-4 left-4 bg-amber-600 text-white px-4 py-2 rounded-full font-bold flex items-center gap-2 z-10">
                <CreditCard size={20} /> Zone Bï¼šå¡ç‰‡è§£å¯†æ¸¬é©—
              </div>

              {phase === 'select' && (
                <div className="w-full max-w-5xl text-center animate-in zoom-in h-full flex flex-col">
                  <div className="mb-4">
                    <h2 className="text-3xl font-black text-amber-900 mb-2">è«‹é¸æ“‡å¡ç‰‡ä¸Šçš„ 3 å€‹è™Ÿç¢¼</h2>
                    <p className="text-amber-600 font-bold">
                      ç›®å‰å·²é¸æ“‡ï¼š
                      <span className="text-2xl mx-2 font-black text-stone-800">
                        {selectedCards.length} / 3
                      </span>
                    </p>
                  </div>
                  
                  <div className="grid grid-cols-4 md:grid-cols-5 gap-3 overflow-y-auto pb-20 px-2 no-scrollbar">
                    {cardData.map((card) => {
                      const isSelected = selectedCards.find(c => c.id === card.id);
                      return (
                        <button
                          key={card.id}
                          onClick={() => handleToggleCard(card)}
                          className={`aspect-square rounded-2xl shadow-md border-b-4 flex flex-col items-center justify-center group transition-all duration-200 ${
                            isSelected 
                              ? 'bg-amber-500 border-amber-700 -translate-y-1' 
                              : 'bg-white border-amber-200 hover:border-amber-400'
                          }`}
                        >
                          <span className={`text-3xl font-black transition-colors ${isSelected ? 'text-white' : 'text-stone-300 group-hover:text-amber-500'}`}>
                            {card.id.toString().padStart(2, '0')}
                          </span>
                          <span className={`text-xs font-bold mt-1 px-1 truncate w-full ${isSelected ? 'text-white' : 'text-stone-500'}`}>
                            {card.title}
                          </span>
                          {isSelected && <CheckCircle2 className="absolute top-2 right-2 text-white" size={20} />}
                        </button>
                      );
                    })}
                  </div>

                  <div className="absolute bottom-6 left-0 w-full flex justify-center">
                    <button 
                      onClick={handleStartQuiz}
                      disabled={selectedCards.length !== 3}
                      className={`px-12 py-4 rounded-full font-black text-2xl shadow-xl flex items-center gap-3 transition-all transform ${
                        selectedCards.length === 3 
                          ? 'bg-stone-800 text-white hover:bg-stone-700 hover:scale-105 active:scale-95 cursor-pointer' 
                          : 'bg-stone-300 text-stone-500 cursor-not-allowed'
                      }`}
                    >
                      {selectedCards.length === 3 ? "é–‹å§‹è§£å¯†" : `è«‹å†é¸ ${3 - selectedCards.length} å€‹`} <ArrowRight />
                    </button>
                  </div>
                </div>
              )}

              {phase === 'quiz' && (
                <div className="w-full max-w-2xl animate-in slide-in-from-right">
                  <div className="flex justify-between items-center mb-6 px-2">
                    <span className="text-amber-800 font-bold uppercase tracking-widest">
                      ä»»å‹™é€²åº¦ {currentCardIdx + 1} / 3
                    </span>
                    <div className="flex gap-2">
                      {selectedCards.map((c, i) => (
                        <div key={i} className={`w-3 h-3 rounded-full ${i === currentCardIdx ? 'bg-amber-600' : i < currentCardIdx ? 'bg-green-500' : 'bg-gray-300'}`} />
                      ))}
                    </div>
                  </div>

                  {/* é¡Œç›®å¡ */}
                  <div className="bg-white p-8 rounded-3xl shadow-xl border-b-8 border-amber-200 mb-6 text-center">
                    <div className="inline-block bg-amber-100 text-amber-800 px-4 py-1 rounded-full font-bold text-sm mb-4">
                      å¡ç‰‡ç·¨è™Ÿ #{selectedCards[currentCardIdx].id.toString().padStart(2, '0')}
                    </div>
                    <h3 className="text-2xl md:text-3xl font-black text-stone-800 leading-snug">
                      {selectedCards[currentCardIdx].q}
                    </h3>
                  </div>

                  {/* é¸é … */}
                  <div className="grid gap-4">
                    {selectedCards[currentCardIdx].options.map((opt, i) => (
                      <button
                        key={i}
                        onClick={() => handleAnswer(i)}
                        disabled={isAnswered}
                        className={`p-5 rounded-xl font-bold text-xl text-left transition-all border-2 flex items-center justify-between ${
                          isAnswered 
                            ? i === selectedCards[currentCardIdx].ans 
                              ? 'bg-green-500 text-white border-green-600 shadow-md' 
                              : 'bg-stone-100 text-stone-400 border-transparent'
                            : 'bg-white text-stone-700 border-stone-200 hover:border-amber-400 hover:shadow-md hover:scale-[1.02]'
                        }`}
                      >
                        <span>{opt}</span>
                        {isAnswered && i === selectedCards[currentCardIdx].ans && <Check size={28} className="animate-bounce" />}
                      </button>
                    ))}
                  </div>

                  {/* çµæœå›é¥‹ */}
                  {isAnswered && (
                    <div className="mt-8 animate-in slide-in-from-bottom flex flex-col items-center text-center">
                      <div className={`text-3xl font-black mb-2 ${isCorrect ? 'text-green-600' : 'text-red-500'}`}>
                        {isCorrect ? "ç­”å°äº†ï¼" : "å†çœ‹ä¸€æ¬¡å¡ç‰‡å–”ï¼"}
                      </div>
                      <button 
                        onClick={handleNextQuestion}
                        className="px-10 py-3 bg-stone-800 text-white rounded-full font-bold text-lg hover:bg-stone-700 shadow-lg flex items-center gap-2"
                      >
                        {currentCardIdx < 2 ? "ä¸‹ä¸€é¡Œ" : "æŸ¥çœ‹çµæœ"} <ArrowRight size={18}/>
                      </button>
                    </div>
                  )}
                </div>
              )}

              {phase === 'summary' && (
                <div className="w-full max-w-lg text-center animate-in zoom-in bg-white p-10 rounded-3xl shadow-2xl border-4 border-amber-200">
                  <div className="text-8xl mb-6">{score === 3 ? 'ğŸ†' : 'ğŸ’ª'}</div>
                  <h2 className="text-4xl font-black text-amber-900 mb-4">æŒ‘æˆ°å®Œæˆï¼</h2>
                  <p className="text-2xl text-stone-600 mb-8">
                    ä½ åœ¨ 3 é¡Œä¸­ç­”å°äº† <span className="text-amber-600 font-bold text-4xl mx-2">{score}</span> é¡Œ
                  </p>
                  
                  <div className="flex gap-4 justify-center">
                    {score === 3 ? (
                      <div className="bg-green-100 px-6 py-4 rounded-xl text-green-800 font-bold w-full">
                        å¤ªæ£’äº†ï¼<br/>ä½ æ˜¯éƒ¨è½çŸ¥è­˜ç‹ï¼
                      </div>
                    ) : (
                      <div className="bg-stone-100 px-6 py-4 rounded-xl text-stone-600 font-bold w-full">
                        åˆ¥ç°å¿ƒï¼<br/>å†ä»”ç´°è®€ä¸€ä¸‹å¡ç‰‡å–”ï¼
                      </div>
                    )}
                  </div>

                  <button onClick={resetAll} className="mt-8 text-stone-400 underline hover:text-stone-600 flex items-center justify-center gap-2 mx-auto">
                    <RefreshCw size={16}/> æ¥å¾…ä¸‹ä¸€ä½
                  </button>
                </div>
              )}
            </div>
          );
        };

        // --- Zone C: åå­—çš„å¥§ç§˜ (ç¶­æŒä¸è®Š) ---
        const NamingZone = () => {
          const [phase, setPhase] = useState('teach');
          const [slideIdx, setSlideIdx] = useState(0);
          
          const slides = [
            { title: "åå­—çš„æ„ç¾©ï¼šå¤§è‡ªç„¶çš„é€£çµ", icon: "ğŸ”ï¸", content: "åŸä½æ°‘çš„åå­—å¸¸å¸¸è·Ÿè‡ªç„¶æœ‰é—œï¼\nä¾‹å¦‚ï¼šCidal (å¤ªé™½)ã€Panay (ç¨»ç©—)ã€Lokay (é¹¿)ã€‚\næˆ‘å€‘ç›¸ä¿¡åå­—æœƒçµ¦å­©å­å¤§è‡ªç„¶çš„åŠ›é‡ã€‚", color: "bg-teal-600" },
            { title: "è¦ªå­é€£ååˆ¶", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", content: "æœ‰äº›æ—ç¾¤ï¼ˆå¦‚é˜¿ç¾æ—ã€æ³°é›…æ—ï¼‰çš„åå­—å¾Œé¢æœƒåŠ ä¸Šçˆ¸çˆ¸æˆ–åª½åª½çš„åå­—ã€‚\nä¾‹å¦‚ï¼šKolas (å…’å­) + Mayaw (çˆ¸çˆ¸) = Kolas Mayawã€‚\né€™ä»£è¡¨æˆ‘å€‘å¾ˆé‡è¦–å®¶æ—çš„è¡€è„ˆèˆ‡å‚³æ‰¿ã€‚", color: "bg-blue-500" },
            { title: "ç”Ÿå‘½è¨˜æ†¶èˆ‡éšç´š", icon: "ğŸ‘¶", content: "æœ‰çš„åå­—æ˜¯ç´€éŒ„å‡ºç”Ÿæ™‚ç™¼ç”Ÿçš„äº‹ï¼ˆå¦‚ä¸‹é›¨ã€é¢±é¢¨ï¼‰ã€‚\nåœ¨æ’ç£æ—æˆ–é­¯å‡±æ—ï¼Œæœ‰äº›åå­—åªæœ‰è²´æ—æˆ–é ­ç›®æ‰èƒ½ä½¿ç”¨ï¼Œä»£è¡¨è‘—ç‰¹æ®Šçš„èº«ä»½èˆ‡æ¦®è€€ã€‚", color: "bg-purple-500" }
          ];

          const fullQuestionBank = [
            { q: "åŸä½æ°‘æ—çš„åå­—å’Œæ¼¢äººåå­—æœ‰ä»€éº¼ä¸åŒï¼Ÿ", opts: ["åŸä½æ°‘æ—çš„åå­—é€šå¸¸æœ‰æ—èªç‰¹è‰²", "å®Œå…¨ä¸€æ¨£", "éƒ½æ˜¯ä¸‰å€‹å­—"], ans: 0 },
            { q: "åŸä½æ°‘æ—çš„å‚³çµ±åå­—æœƒå’Œä»€éº¼æœ‰é—œï¼Ÿ", opts: ["è‡ªç„¶ï¼ˆå±±ã€æ²³æµï¼‰", "å¤©æ°£ï¼ˆä¸‹é›¨ï¼‰", "ä»¥ä¸Šçš†æ˜¯"], ans: 2 },
            { q: "æœ‰äº›åŸä½æ°‘æ—çš„åå­—ï¼Œå¾Œé¢æœƒåŠ ä¸Šèª°çš„åå­—ï¼Ÿ", opts: ["çˆ¸çˆ¸æˆ–åª½åª½", "é„°å±…", "è€å¸«"], ans: 0 },
            { q: "å¦‚æœåå­—å« Panay (ç¨»ç©—)ï¼Œå¯èƒ½ä»£è¡¨é•·è¼©å¸Œæœ›ä»–ï¼Ÿ", opts: ["å¾ˆæ„›åƒé£¯", "åƒç¨»ç©—ä¸€æ¨£è¬™è™›", "å»ç¨®ç”°"], ans: 1 },
            { q: "åå­—è£¡æœ‰ Cidal (å¤ªé™½)ï¼Œé€šå¸¸ä»£è¡¨ä»€éº¼ï¼Ÿ", opts: ["åƒå¤ªé™½ä¸€æ¨£æº«æš–", "æ€•æ›¬é»‘", "å–œæ­¡å¤å¤©"], ans: 0 },
            { q: "ç‚ºä»€éº¼æœ‰äº›åŸä½æ°‘æœ‰å…©å€‹åå­—ï¼Ÿ", opts: ["æ–¹ä¾¿ä¸åŒå ´åˆä½¿ç”¨", "æƒ³è¦å…©å€‹èº«ä»½", "åå­—å¤ªé•·"], ans: 0 },
            { q: "æ³°é›…æ—çš„å‘½åå‚³çµ±ï¼Œåå­—ä»£è¡¨ä»€éº¼ï¼Ÿ", opts: ["å®¶æ—è¡€çµ±èˆ‡å‚³æ‰¿", "é‹å‹•æ¯”è³½", "æ–°ç™¼æ˜"], ans: 0 },
            { q: "åŸä½æ°‘æ—çš„åå­—ç‚ºä»€éº¼é€™éº¼é‡è¦ï¼Ÿ", opts: ["ä»£è¡¨æ–‡åŒ–èˆ‡å‚³æ‰¿", "è€ƒè©¦æ¯”è¼ƒå¥½å¯«", "éš¨ä¾¿å–çš„"], ans: 0 },
            { q: "æœ‰äº›åå­—æœƒæ ¹æ“šä»€éº¼ä¾†å–ï¼Ÿ", opts: ["å‡ºç”Ÿæ™‚çš„ç‹€æ³", "ç•¶å¤©åƒä»€éº¼", "é›»è¦–æ¼”ä»€éº¼"], ans: 0 },
            { q: "å¸ƒè¾²æ—çš„ç”·ç”Ÿåå­—ï¼Œé€šå¸¸è·Ÿä»€éº¼æœ‰é—œï¼Ÿ", opts: ["ç¥–å…ˆçš„åå­—", "æ°´æœ", "æ–‡å…·"], ans: 0 },
            { q: "åå­—æœ‰æ™‚å€™å’Œå®¶æ—çš„è¼©åˆ†æœ‰é—œï¼Œé€™è¡¨ç¤ºï¼Ÿ", opts: ["å¯ä»¥çŸ¥é“å®¶æ—é—œä¿‚", "åªèƒ½ç”¨çˆ¸çˆ¸åå­—", "è¦ç”¨å¤§å°é–‹é ­"], ans: 0 },
            { q: "å¦‚æœå‡ºç”Ÿæ™‚å¤ªé™½å¾ˆå¤§ï¼Œåå­—å¯èƒ½å–å«ï¼Ÿ", opts: ["å¤ªé™½ (Cidal)", "æœˆäº®", "æ˜Ÿæ˜Ÿ"], ans: 0 },
            { q: "åŸä½æ°‘çš„åå­—æ˜¯ä¸€ç¨®å¯¶è—ï¼Œå› ç‚ºï¼Ÿ", opts: ["åŒ…å«å®¶æ—æ•…äº‹èˆ‡æ–‡åŒ–", "å¾ˆå€¼éŒ¢", "åå­—å¾ˆé•·"], ans: 0 },
            { q: "åŸä½æ°‘æ—å‚³çµ±ä¸Šæ€éº¼ç¨±å‘¼å°æ–¹ï¼Ÿ", opts: ["ç›´æ¥å«åå­—", "å–‚ï¼", "åªå«ç¶½è™Ÿ"], ans: 0 },
            { q: "ä»¥å‰æœ‰äº›å­©å­é•·å¤§å¾Œï¼Œæœƒç¹¼æ‰¿èª°çš„åå­—ï¼Ÿ", opts: ["ç¥–çˆ¶æ¯æˆ–çˆ¶æ¯", "è€å¸«", "å¶åƒ"], ans: 0 },
            { q: "åœ¨å‘å—æ—ï¼Œæœ‰æ™‚å€™æœƒç”¨ä»€éº¼é †åºå‘½åï¼Ÿ", opts: ["å‡ºç”Ÿçš„é †åº (è€å¤§/è€ä¹ˆ)", "èº«é«˜", "é«”é‡"], ans: 0 },
            { q: "æœ‰äº›åå­—é•·å¤§å¾Œæœƒæ”¹è®Šï¼Œä»£è¡¨ï¼Ÿ", opts: ["é€²å…¥äººç”Ÿä¸åŒéšæ®µ", "èˆŠåå­—ä¸å¥½è½", "è¶•æµè¡Œ"], ans: 0 },
            { q: "åœ¨æŸäº›æ—ç¾¤ï¼Œåå­—ä»£è¡¨äº†ä»€éº¼ï¼Ÿ", opts: ["å®¶æ—çš„æ­·å²æˆ–ç‰¹è‰²", "è€ƒè©¦åˆ†æ•¸", "å¡é€šäººç‰©"], ans: 0 },
            { q: "å­©å­çš„åå­—å¯èƒ½ä¾†è‡ªå“ªè£¡ï¼Ÿ", opts: ["çˆ¶æ¯æˆ–ç¥–å…ˆçš„åå­—", "éš¨ä¾¿é¸", "é›»è¦–è§’è‰²"], ans: 0 },
            { q: "åå­—è£¡æœ‰ã€Œå±±ã€ï¼Œå¯èƒ½ä»£è¡¨ï¼Ÿ", opts: ["å®¶æ—å’Œå±±æœ‰é—œ", "æ„›çˆ¬å±±", "ä½å¤§æ¨“"], ans: 0 },
          ];

          const [quizQuestions, setQuizQuestions] = useState([]);
          const [currentQ, setCurrentQ] = useState(0);
          const [score, setScore] = useState(0);
          const [showFeedback, setShowFeedback] = useState(false);
          const [selectedOpt, setSelectedOpt] = useState(null);

          const nextSlide = () => {
            if (slideIdx < slides.length - 1) {
              setSlideIdx(prev => prev + 1);
            } else {
              const shuffled = [...fullQuestionBank].sort(() => 0.5 - Math.random());
              setQuizQuestions(shuffled.slice(0, 3));
              setPhase('quiz');
              setCurrentQ(0);
              setScore(0);
            }
          };

          const prevSlide = () => {
            if (slideIdx > 0) setSlideIdx(prev => prev - 1);
          };

          const handleAnswer = (optIndex) => {
            if (showFeedback) return;
            setSelectedOpt(optIndex);
            setShowFeedback(true);
            if (optIndex === quizQuestions[currentQ].ans) {
              setScore(s => s + 1);
            }
            setTimeout(() => {
              if (currentQ < 2) {
                setCurrentQ(q => q + 1);
                setShowFeedback(false);
                setSelectedOpt(null);
              } else {
                setPhase('result');
              }
            }, 1500);
          };

          const restart = () => {
            setPhase('teach');
            setSlideIdx(0);
          };

          return (
            <div className="flex flex-col items-center justify-center h-full bg-violet-50 p-4">
              <div className="absolute top-4 left-4 bg-violet-600 text-white px-4 py-2 rounded-full font-bold flex items-center gap-2 z-10">
                <UserCheck size={20} /> Zone Cï¼šåå­—çš„å¥§ç§˜
              </div>

              {phase === 'teach' && (
                <div className="w-full max-w-2xl text-center animate-in zoom-in">
                  <div className="bg-white p-8 rounded-3xl shadow-2xl border-4 border-violet-100 relative min-h-[420px] flex flex-col justify-center items-center">
                    <div className="absolute top-6 flex gap-2">
                      {slides.map((_, i) => (
                        <div key={i} className={`w-3 h-3 rounded-full ${i === slideIdx ? 'bg-violet-600' : 'bg-gray-200'}`} />
                      ))}
                    </div>
                    <div className="text-8xl mb-6">{slides[slideIdx].icon}</div>
                    <h2 className={`text-2xl md:text-3xl font-black mb-6 ${slides[slideIdx].color} text-white px-6 py-2 rounded-full shadow-md`}>
                      {slides[slideIdx].title}
                    </h2>
                    <div className="text-lg md:text-xl text-gray-600 font-bold leading-relaxed whitespace-pre-line text-left md:text-center w-full">
                      {slides[slideIdx].content}
                    </div>
                  </div>
                  <div className="flex justify-between mt-8 px-4 gap-4">
                    <button onClick={prevSlide} disabled={slideIdx === 0} className={`flex-1 px-6 py-3 rounded-xl font-bold flex items-center justify-center gap-2 ${slideIdx === 0 ? 'text-gray-300' : 'bg-white text-violet-600 shadow-md hover:bg-violet-50'}`}>
                      <ChevronLeft /> ä¸Šä¸€é 
                    </button>
                    <button onClick={nextSlide} className="flex-[2] px-6 py-3 bg-violet-600 text-white rounded-xl font-black text-xl shadow-lg hover:bg-violet-700 flex items-center justify-center gap-2">
                      {slideIdx === slides.length - 1 ? "é–‹å§‹æŒ‘æˆ°ï¼" : "ä¸‹ä¸€é "} <ChevronRight />
                    </button>
                  </div>
                </div>
              )}

              {phase === 'quiz' && quizQuestions.length > 0 && (
                <div className="w-full max-w-2xl animate-in slide-in-from-right">
                  <div className="flex justify-between items-center mb-6 px-2">
                    <span className="text-violet-400 font-bold uppercase tracking-widest">Question {currentQ + 1} / 3</span>
                    <span className="bg-violet-200 text-violet-800 px-3 py-1 rounded-full font-bold text-sm">Score: {score}</span>
                  </div>
                  <div className="bg-white p-8 rounded-3xl shadow-xl border-b-8 border-violet-200 mb-6 min-h-[180px] flex items-center justify-center">
                    <h3 className="text-2xl font-black text-gray-800 leading-snug text-center">
                      {quizQuestions[currentQ].q}
                    </h3>
                  </div>
                  <div className="grid gap-4">
                    {quizQuestions[currentQ].opts.map((opt, i) => (
                      <button
                        key={i}
                        onClick={() => handleAnswer(i)}
                        disabled={showFeedback}
                        className={`p-4 rounded-xl font-bold text-lg text-left transition-all border-2 ${
                          showFeedback 
                            ? i === quizQuestions[currentQ].ans 
                              ? 'bg-green-500 text-white border-green-600 scale-105' 
                              : i === selectedOpt 
                                ? 'bg-red-500 text-white border-red-600'
                                : 'bg-gray-100 text-gray-400 border-transparent'
                            : 'bg-white text-gray-700 border-gray-200 hover:border-violet-400 hover:shadow-md'
                        }`}
                      >
                        <div className="flex items-center gap-3">
                          <div className="w-8 h-8 rounded-full border-2 border-current flex items-center justify-center text-sm opacity-50">
                            {String.fromCharCode(65 + i)}
                          </div>
                          {opt}
                        </div>
                      </button>
                    ))}
                  </div>
                </div>
              )}

              {phase === 'result' && (
                <div className="animate-in zoom-in bg-white p-10 rounded-3xl shadow-2xl border-4 border-violet-100 text-center max-w-md w-full">
                  <div className="text-8xl mb-6">{score === 3 ? 'ğŸ‰' : 'ğŸ“š'}</div>
                  <h2 className="text-4xl font-black text-violet-900 mb-4">æŒ‘æˆ°çµæŸï¼</h2>
                  <p className="text-2xl text-gray-600 mb-8">
                    ä½ ç­”å°äº† <span className="text-violet-600 font-bold text-4xl mx-2">{score}</span> é¡Œ
                  </p>
                  <button onClick={restart} className="text-gray-400 underline hover:text-violet-600 flex items-center justify-center gap-2 mx-auto">
                    <RefreshCw size={16}/> é‡æ–°é–‹å§‹
                  </button>
                </div>
              )}
            </div>
          );
        };

        // --- Zone D: åŸ‹è—çš„ç›’å­ (å¯†ç¢¼é–ç‰ˆ + ç¢ºèªéµ) ---
        const LotteryZone = () => {
          const [isUnlocked, setIsUnlocked] = useState(false);
          const [inputCode, setInputCode] = useState("");
          const [errorShake, setErrorShake] = useState(false);

          const [state, setState] = useState('idle');
          const [prize, setPrize] = useState(null);
          const [errorMsg, setErrorMsg] = useState("");

          const demoPrizes = [
            { name: "ç‰¹çï¼šè—èŠ½å–‡å­", count: 1, type: "big" },
            { name: "å¯¦ç”¨çï¼šè¡›ç”Ÿç´™", count: 50, type: "small" },
            { name: "åƒåŠ çï¼šç³–æœä¸€é¡†", count: 999, type: "small" },
          ];

          // --- Password Logic ---
          const handleKeypad = (num) => {
            if (inputCode.length < 4) {
              const newCode = inputCode + num;
              setInputCode(newCode);
              // å–æ¶ˆè‡ªå‹•æª¢æŸ¥ï¼Œç­‰å¾…æŒ‰ä¸‹ Enter éµ
            }
          };

          const handleDelete = () => {
            setInputCode(prev => prev.slice(0, -1));
          };

          const handleEnter = () => {
            if (inputCode === "1234") {
              setIsUnlocked(true);
            } else {
              setErrorShake(true);
              setTimeout(() => {
                setErrorShake(false);
                setInputCode("");
              }, 500);
            }
          };

          // --- Lottery Logic ---
          const drawPrize = async () => {
            if (state === 'drawing') return;
            setState('drawing');
            setErrorMsg("");
            try {
              if (GAS_API_URL) {
                const timestamp = new Date().getTime();
                const response = await fetch(`${GAS_API_URL}?action=draw&t=${timestamp}`, {
                  method: "GET",
                  mode: 'cors',
                  credentials: 'omit',
                  redirect: 'follow',
                  headers: { "Content-Type": "text/plain;charset=utf-8" },
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                if (data.error === "No prizes left!") {
                   setPrize(data.prize || { name: "éŠ˜è¬æƒ é¡§", type: "none" });
                   setState('result');
                   return; 
                }
                if (data.error) throw new Error(data.error);
                setPrize(data.prize);
              } else {
                await new Promise(r => setTimeout(r, 2000));
                setPrize(demoPrizes[Math.floor(Math.random() * demoPrizes.length)]);
              }
              setState('result');
            } catch (err) {
              console.error(err);
              setErrorMsg(err.message);
              const randomPrize = demoPrizes[Math.floor(Math.random() * demoPrizes.length)];
              setPrize(randomPrize);
              setState('result');
            }
          };

          const reset = () => { 
            setState('idle'); 
            setPrize(null);
            setIsUnlocked(false); // Reset lock when finished
            setInputCode("");
          };

          if (!isUnlocked) {
            return (
              <div className="flex flex-col items-center justify-center h-full bg-indigo-950 p-4 relative overflow-hidden">
                <div className="absolute top-4 left-4 bg-indigo-500 text-white px-4 py-2 rounded-full font-bold flex items-center gap-2 border border-indigo-400 z-10">
                  <Gift size={20} /> Zone Dï¼šåŸ‹è—çš„ç›’å­
                </div>
                
                <div className="w-full max-w-sm text-center z-10">
                  <div className="mb-8 animate-bounce text-indigo-400">
                    <Lock size={64} className="mx-auto"/>
                  </div>
                  <h2 className="text-2xl font-bold text-white mb-6">è«‹è¼¸å…¥å¯†ç¢¼é–‹å•Ÿå¯¶ç®±</h2>
                  
                  {/* Dots Display */}
                  <div className={`flex justify-center gap-4 mb-8 ${errorShake ? 'shake' : ''}`}>
                    {[...Array(4)].map((_, i) => (
                      <div key={i} className={`w-4 h-4 rounded-full border-2 border-white transition-all ${i < inputCode.length ? 'bg-white' : 'bg-transparent'}`}></div>
                    ))}
                  </div>

                  {/* Keypad */}
                  <div className="grid grid-cols-3 gap-4">
                     {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                      <button 
                        key={num} 
                        onClick={() => handleKeypad(num.toString())}
                        className="w-20 h-20 rounded-full bg-white/10 text-white text-2xl font-bold hover:bg-white/30 transition-all border border-indigo-500/30 flex items-center justify-center select-none"
                      >
                        {num}
                      </button>
                    ))}
                    <button 
                      onClick={handleDelete}
                      className="w-20 h-20 rounded-full text-red-300 hover:bg-red-500/20 transition-all flex items-center justify-center border border-red-500/30 select-none"
                    >
                      <Delete size={28}/>
                    </button>
                    <button 
                      onClick={() => handleKeypad("0")}
                      className="w-20 h-20 rounded-full bg-white/10 text-white text-2xl font-bold hover:bg-white/30 transition-all border border-indigo-500/30 flex items-center justify-center select-none"
                    >
                      0
                    </button>
                    <button 
                      onClick={handleEnter}
                      className="w-20 h-20 rounded-full bg-green-500 text-white text-2xl font-bold hover:bg-green-400 transition-all border border-green-400 shadow-[0_0_15px_rgba(34,197,94,0.5)] flex items-center justify-center select-none"
                    >
                      <LogIn size={32}/>
                    </button>
                  </div>

                </div>
              </div>
            );
          }

          return (
            <div className="flex flex-col items-center justify-center h-full bg-indigo-900 p-4 relative overflow-hidden">
              <div className="absolute top-4 left-4 bg-indigo-500 text-white px-4 py-2 rounded-full font-bold flex items-center gap-2 border border-indigo-400 z-10">
                <Gift size={20} /> Zone Dï¼šåŸ‹è—çš„ç›’å­
              </div>
              <div className="z-10 w-full max-w-lg text-center">
                {state === 'idle' && (
                  <div className="animate-in zoom-in">
                    <div className="text-6xl mb-8 animate-bounce">ğŸ“¦</div>
                    <h2 className="text-3xl font-black text-white mb-4">æˆ‘å€‘æ‰¾åˆ°ç›’å­äº†ï¼</h2>
                    <button onClick={drawPrize} className="px-12 py-6 bg-yellow-500 text-yellow-900 text-3xl font-black rounded-full shadow-lg hover:scale-105 transition-transform">æ‰“é–‹ç›’å­</button>
                    {errorMsg && <div className="mt-4 text-red-300 text-sm">é€£ç·šç•°å¸¸ï¼Œå·²åˆ‡æ›è‡³å‚™ç”¨æ¨¡å¼</div>}
                  </div>
                )}
                {state === 'drawing' && <div className="text-white text-2xl font-bold animate-pulse">è§£é–ä¸­...</div>}
                {state === 'result' && prize && (
                  <div className="bg-white p-10 rounded-3xl shadow-2xl animate-in zoom-in transform rotate-1">
                     <div className="text-8xl mb-4">{prize.type === 'big' ? 'ğŸ†' : 'ğŸ¬'}</div>
                     <h3 className="text-indigo-400 font-bold uppercase tracking-widest mb-2">ç²å¾—ä¿¡ç‰©</h3>
                     <h2 className="text-4xl font-black text-indigo-600 mb-4">{prize.name}</h2>
                     <button onClick={reset} className="text-gray-400 underline">å†è©¦ä¸€æ¬¡</button>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // --- ä¸»æ¡†æ¶ ---
        function InteractiveApp() {
          const [activeZone, setActiveZone] = useState('A');

          return (
            <div className="flex w-full h-screen bg-stone-900 font-sans text-gray-800 overflow-hidden select-none">
              <div className="w-20 md:w-64 bg-stone-800 h-full flex flex-col shadow-2xl z-20 border-r border-stone-700">
                <div className="p-4 md:p-6 bg-stone-900 border-b border-stone-700">
                  <h1 className="text-white font-black text-xl flex flex-col md:flex-row items-start md:items-center gap-2">
                    <div className="flex items-center gap-2">
                      <Map className="text-amber-500" />
                      <span>2026ä¸–ç•Œæ¯èªæ—¥</span>
                    </div>
                    <span className="text-sm md:text-lg text-amber-500 font-bold">makila kuman</span>
                  </h1>
                </div>
                <div className="flex-1 py-4 space-y-2 overflow-y-auto no-scrollbar">
                  <NavBtn id="A" title="åŸä½æ°‘æ–‡åŒ–çŸ¥è­˜é€š" icon={BookOpen} active={activeZone === 'A'} onClick={() => setActiveZone('A')} color="text-amber-400" />
                  <NavBtn id="B" title="å¡ç‰‡è§£å¯†æ¸¬é©—" icon={Edit3} active={activeZone === 'B'} onClick={() => setActiveZone('B')} color="text-sky-400" />
                  <NavBtn id="C" title="åå­—çš„å¥§ç§˜" icon={UserCheck} active={activeZone === 'C'} onClick={() => setActiveZone('C')} color="text-violet-400" />
                  <div className="my-2 border-t border-stone-700 mx-4"></div>
                  <NavBtn id="D" title="åŸ‹è—çš„ç›’å­" icon={Gift} active={activeZone === 'D'} onClick={() => setActiveZone('D')} color="text-indigo-400" />
                </div>
              </div>
              <div className="flex-1 h-full relative bg-stone-100">
                {activeZone === 'A' && <TribeIntroZone />}
                {activeZone === 'B' && <TribeQuizZone />}
                {activeZone === 'C' && <NamingZone />}
                {activeZone === 'D' && <LotteryZone />}
              </div>
            </div>
          );
        }

        const NavBtn = ({ id, title, icon: Icon, active, onClick, color }) => (
          <button onClick={onClick} className={`w-full p-4 flex items-center gap-4 transition-all relative group ${active ? 'bg-stone-700' : 'hover:bg-stone-700/50'}`}>
            <div className={`p-2 rounded-lg ${active ? 'bg-stone-900' : 'bg-stone-800 group-hover:bg-stone-900'}`}><Icon className={color} size={24} /></div>
            <div className={`text-left hidden md:block font-bold ${active ? 'text-white' : 'text-stone-400'}`}>{title}</div>
            {active && <div className={`absolute left-0 top-0 bottom-0 w-1 ${color.replace('text', 'bg')}`} />}
          </button>
        );

        // æ¸²æŸ“åˆ°é é¢
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<InteractiveApp />);
    </script>
</body>
</html>
